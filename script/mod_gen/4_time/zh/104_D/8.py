def main():
    S = input()
    Q = S.count('?')
    A = S.count('A')
    B = S.count('B')
    C = S.count('C')
    # print('Q=', Q)
    # print('A=', A)
    # print('B=', B)
    # print('C=', C)
    # print('S=', S)
    # print('3^Q=', 3**Q)
    # print('3^Q%1000000007=', 3**Q%1000000007)
    # print('3^Q%1000000007*Q=', 3**Q%1000000007*Q)
    # print('3^Q%1000000007*Q%1000000007=', 3**Q%1000000007*Q%1000000007)
    # print('3^Q%1000000007*A=', 3**Q%1000000007*A)
    # print('3^Q%1000000007*A%1000000007=', 3**Q%1000000007*A%1000000007)
    # print('3^Q%1000000007*A%1000000007*B=', 3**Q%1000000007*A%1000000007*B)
    # print('3^Q%1000000007*A%1000000007*B%1000000007=', 3**Q%1000000007*A%1000000007*B%1000000007)
    # print('3^Q%1000000007*A%1000000007*B%1000000007*C=', 3**Q%1000000007*A%1000000007*B%1000000007*C)
    # print('3^Q%1000000007*A%1000000007*B%1000000007*C%1000000007=', 3**Q%1000000007*A%1000000007*B%1000000007*C%1000000007)
    print((3**Q%1000000007*Q%1000000007+3**Q%1000000007*A%1000000007*B%1000000007+3**Q%1000000007*A%1000000007*C%1000000007)%1000000007)

if __name__ == '__main__':
    main()