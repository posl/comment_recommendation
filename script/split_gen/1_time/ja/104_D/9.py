def main():
    S = input()
    N = len(S)
    # 3**N は最大でも 3**10**5 = 3**10**5 であり、これは 10**15 であり、
    # 10**15 は int の最大値である 10**18 より小さい。
    # したがって、3**N を計算しておいてもオーバーフローしない。
    # また、3**N は 3**Q に等しい。
    Q = S.count('?')
    MOD = 10**9 + 7
    ans = 0
    # 3**Q 通りの文字列それぞれについて、ABC 数を求める。
    for i in range(3**Q):
        # 3**Q 通りの文字列それぞれについて、
        # 3**Q 通りの文字列のうち i 番目の文字列における
        # 「? を A, B, C のいずれかに置き換えたときの文字列」を求める。
        # このとき、i は 3 進数とみなして、i の各桁を 0, 1, 2 とみなす。
        # 例えば、i = 3 ならば、i の各桁は 1, 0, 0 となる。
        # このとき、3**Q 通りの文字列のうち i 番目の文字列における
        # 「? を A, B, C のいずれかに置き換えたときの文字列」は
        # ?AC である。
        # このとき、i の各桁は 1, 0, 0 となる。
        # このとき、3**Q 通りの文字列のうち i 番目の文字列における
        # 「? を A, B, C のいずれかに
